<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sukapesta — Scanner</title>
<script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
<style>
  body { font-family: Arial; padding: 20px; }
  #reader { width: 100%; max-width: 400px; margin-bottom: 20px; }
  .good { color: green; font-weight: bold; }
  .bad { color: red; font-weight: bold; }
</style>
</head>
<body>

<h2>Scanner Tiket — Sukapesta</h2>
<div id="reader"></div>
<div id="result"></div>
<hr>
<p>Atau masukkan kode manual:</p>
<input id="manualId" placeholder="SP-00001"/>
<button id="checkBtn">Cek</button>

<script>
const repoBase = 'tickets.json'; // path JSON lokal atau repo GitHub raw

function displayMessage(html){ document.getElementById('result').innerHTML = html; }

function checkId(id){
  displayMessage('Checking ' + id + ' ...');
  fetch(repoBase)
    .then(r=>r.json())
    .then(data=>{
      const ticket = data.find(t=>t.id===id);
      if(!ticket){
        displayMessage('<div class="bad">❌ KODE TIDAK DITEMUKAN</div>'); return;
      }
      if(ticket.status === 'unused'){
        displayMessage(`<div class="good">✔ TIKET VALID — ID: ${id}</div>`);
      } else {
        displayMessage(`<div class="bad">❌ TIKET SUDAH DIGUNAKAN</div>`);
      }
    })
    .catch(e=>displayMessage('<div class="bad">Error load data</div>'));
}

document.getElementById('checkBtn').addEventListener('click', ()=>{
  const id = (document.getElementById('manualId').value||'').trim();
  if(id) checkId(id);
});

// Camera scanner
const html5QrCode = new Html5Qrcode("reader");
html5QrCode.start(
  { facingMode: "environment" },
  { fps: 10, qrbox: 250 },
  (decodedText)=>{ checkId(decodedText.trim()); },
  (err)=>{}
).catch(err=>displayMessage('<div class="bad">Camera error: '+err+'</div>'));
</script>

</body>
</html>
