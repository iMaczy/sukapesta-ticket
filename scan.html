<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Scanner Tiket SUKAPESTA</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="wrap">
<h2>Scanner Tiket — Sukapesta</h2>
<div id="reader" style="width:100%"></div>
<div id="result"></div>
<hr/>
<p>Atau masukkan kode manual:</p>
<input id="manualId" placeholder="SP-00001"/>
<button id="checkBtn">Cek</button>
</div>

<script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzFHNKl5a1wYYdY03UtybsGOKk_9QpYPB4VmI3i75PsK942OpokRC8ob0OC1CDcj7ZQmQ/exec";

function displayMessage(html){ document.getElementById('result').innerHTML=html; }

async function checkId(kode){
  try{
    const resp = await fetch(WEB_APP_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({action:'check',kode})
    });
    const data = await resp.json();
    if(data.status==='VALID') displayMessage(`<div class="good">✔ TIKET VALID & HANGUS — ${kode}</div>`);
    else if(data.status==='USED') displayMessage(`<div class="bad">❌ TIKET SUDAH DIGUNAKAN</div>`);
    else displayMessage(`<div class="bad">❌ KODE TIDAK DITEMUKAN</div>`);
  }catch(e){ displayMessage(`<div class="bad">Error: ${e.message}</div>`); }
}

document.getElementById('checkBtn').addEventListener('click',()=>{
  const id = (document.getElementById('manualId').value||'').trim();
  if(id) checkId(id);
});

const html5QrCode = new Html5Qrcode("reader");
html5QrCode.start(
  {facingMode:"environment"},
  {fps:10,qrbox:250},
  (decodedText)=>{ checkId(decodedText.trim()); },
  (errorMessage)=>{}
).catch(err=>displayMessage('<div class="bad">Camera error: '+err+'</div>'));
</script>
</body>
</html>

