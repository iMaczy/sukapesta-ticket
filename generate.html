<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Generate Ticket</title>
<style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    input { padding: 10px; width: 200px; margin-right: 10px; }
    button { padding: 10px 15px; cursor: pointer; }
</style>
</head>
<body>

<h2>Generate Tiket SUKAPESTA</h2>

<label>Nomor Tiket:</label>
<input type="text" id="ticketNumber" placeholder="SP-00001">
<button onclick="generateTicket()">Generate</button>

<br><br>
<canvas id="ticketCanvas"></canvas>
<br>
<a id="downloadLink" download="ticket.png" style="display:none;">
    <button>Download Tiket</button>
</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
async function generateTicket() {
    const ticketNum = document.getElementById("ticketNumber").value.trim();
    if (!ticketNum) { alert("Masukkan nomor tiket!"); return; }

    const canvas = document.getElementById("ticketCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = 600;
    canvas.height = 300;
    ctx.fillStyle = "#fff";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Tulis nomor tiket
    ctx.font = "bold 40px Arial";
    ctx.fillStyle = "#000";
    ctx.textAlign = "center";
    ctx.fillText(ticketNum, canvas.width/2, 50);

    // Generate QR code yang sama persis dengan id JSON
    const qrCanvas = document.createElement("div");
    new QRCode(qrCanvas, { text: ticketNum, width: 200, height: 200 });

    // Wait sebentar untuk render
    await new Promise(r => setTimeout(r, 500));

    // Copy QR ke canvas
    const img = qrCanvas.querySelector("img");
    ctx.drawImage(img, canvas.width/2 - 100, 100, 200, 200);

    // Download link
    const link = document.getElementById("downloadLink");
    link.href = canvas.toDataURL();
    link.download = "TIKET_" + ticketNum + ".png";
    link.style.display = "inline-block";
}
</script>
</body>
</html>
