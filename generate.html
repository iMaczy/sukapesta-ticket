<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Generate Ticket</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }

    #ticketCanvas {
        border: 1px solid #ccc;
        margin-top: 20px;
    }

    .qr-container {
        position: absolute;
        left: 62%; /* geser sedikit ke kanan */
        top: 33%;  /* posisi vertikal tetap */
        transform: translate(-50%, -50%);
        width: 120px; /* QR diperkecil lagi */
        height: 120px;
    }

    #qrCode {
        width: 100%;
        height: 100%;
    }
</style>
</head>
<body>

<h2>Generate Ticket</h2>

<label>ID Ticket:</label>
<input type="text" id="ticketId" value="SP-00001">
<button onclick="generateTicket()">Generate</button>

<br><br>

<canvas id="ticketCanvas" width="1080" height="1920"></canvas>

<script>
async function generateTicket() {
    const id = document.getElementById('ticketId').value;
    const canvas = document.getElementById('ticketCanvas');
    const ctx = canvas.getContext('2d');

    // Load Template
    const template = new Image();
    template.src = "ticket_template.png";

    template.onload = () => {
        ctx.drawImage(template, 0, 0, canvas.width, canvas.height);

        // Generate QR Code (hidden container)
        const qrTemp = document.createElement("div");
        qrTemp.style.display = "inline-block";
        new QRCode(qrTemp, {
            text: id,
            width: 300,
            height: 300
        });

        // Load generated QR image
        const qrImg = qrTemp.querySelector("img");
        
        qrImg.onload = () => {
            // Draw QR at adjusted position
            const qrSize = 230; // ukuran kecil lagi
            const qrX = canvas.width * 0.61 - qrSize / 2; // geser sedikit ke kanan
            const qrY = canvas.height * 0.33 - qrSize / 2;

            ctx.drawImage(qrImg, qrX, qrY, qrSize, qrSize);

            // Auto-download ticket
            const link = document.createElement("a");
            link.download = `ticket_${id}.png`;
            link.href = canvas.toDataURL();
            link.click();
        };
    };
}
</script>

</body>
</html>
